# Vocab Card Game v2 — 局外 Meta 系統設計

> 對齊 `2026-02-12-redesign-handoff.md` 待辦順序第 1 項。
> 範圍：解鎖、牌組、難度、成就（局外）。

---

## 一、設計目標

1. 讓玩家在局外有長期目標，但不破壞局內隨機與重開節奏。
2. Meta 成長採「加法」，提供新策略，不做硬性減法限制。
3. 讓英語學習成果可被看見：詞彙覆蓋率、精通數、薄弱詞回補。

---

## 二、Meta 資源

| 資源 | 取得方式 | 用途 |
|------|---------|------|
| `XP` | 每局結算、成就 | 玩家等級與帳號進度 |
| `LP` (Lexicon Point) | 局內答題表現、里程碑 | 詞庫擴展與學習向解鎖 |
| `CP` (Curriculum Point) | 過 Boss、大關首次通關 | 課程節點（全局被動） |

規則：
- `LP` 與 `CP` 是局外貨幣，不進入單局商店。
- 局內金幣仍維持獨立循環，不可直接兌換為 `LP/CP`。

---

## 三、解鎖系統

### 3.1 詞庫分段解鎖

- 以 CEFR 與頻率分層：`T1(1000) -> T2(2000) -> T3(3000) -> T4(5000) -> T5(8000+)`
- 解鎖條件（同時滿足）：
  - 前層 `Lv.2+` 覆蓋率達門檻
  - 累計局數達門檻
  - 支付 `LP`

| 層級 | 覆蓋率門檻 | 局數門檻 | LP 成本 |
|------|-----------|---------|--------|
| T2 | 60% | 30 局 | 100 |
| T3 | 65% | 80 局 | 180 |
| T4 | 70% | 160 局 | 300 |
| T5 | 75% | 260 局 | 500 |

### 3.2 Build 內容解鎖

- 語感卡、教材卡、詞綴卡、課程卡走「發現後永久入池」模式。
- 首次發現後，卡池權重上升但不保證每局出現。
- 稀有度以「可見率提升」取代「保證掉落」。

### 3.3 功能性解鎖

- `Deck Slot +1`：增加可保存牌組模板數。
- `Study Log`：解鎖完整錯題分析與詞族圖。
- `Challenge Stake`：開啟更高難度層。

---

## 四、牌組系統（局外）

### 4.1 牌組模板

- 玩家可保存 `N` 組模板（預設 3 組，可解鎖到 8 組）。
- 模板保存內容：
  - 優先元素權重
  - 優先詞性權重
  - 禁用詞綴偏好
  - 目標牌型偏好（例如語序鏈/同族花）

### 4.2 起始牌組偏好

- 不提供「固定強牌起手」。
- 只提供抽樣偏好，避免破壞 roguelike 變化：
  - `Balanced`
  - `Element Focus`
  - `Grammar Focus`
  - `Long Word Focus`

### 4.3 養牌保留

- 單字等級、遺忘計時、精通標記是帳號級資料。
- 單局中獲得的臨時版本效果不帶出局。

---

## 五、難度系統（Stakes）

### 5.1 設計原則

- 難度做加法，不關閉核心玩法。
- 高難優先提高目標分數、限制資源、增加 Boss 規則複合度。

### 5.2 難度層級

| Stake | 解鎖條件 | 變更 |
|------|---------|------|
| S0 | 預設 | 基準規則 |
| S1 | 通關一次 | Boss 目標分數 +10% |
| S2 | S1 通關 | 商店免費重擲次數 -1 |
| S3 | S2 通關 | 大盲注限制雙詞條機率 +20% |
| S4 | S3 通關 | 起始金幣 -2 |
| S5 | S4 通關 | Boss 回合容錯降低（答錯懲罰提高） |

### 5.3 難度獎勵

- Stake 越高，局末 `XP/LP/CP` 乘數越高。
- 乘數建議：`S0 x1.0`, `S1 x1.1`, `S2 x1.2`, `S3 x1.35`, `S4 x1.5`, `S5 x1.7`。

---

## 六、成就系統

### 6.1 成就類型

| 類型 | 示例 | 獎勵 |
|------|------|------|
| 學習里程碑 | 精通 100 詞 | `LP` + 詞庫滴入加速 |
| 玩法里程碑 | 單局語序鏈達 10 次 | 解鎖語法向語感卡 |
| 風格里程碑 | 50 次賭一把成功 | 解鎖高風險卡池權重 |
| 挑戰里程碑 | S3 通關 | 解鎖下一 Stake |
| 收集里程碑 | 發現 80% 語感卡 | `CP` + 展示徽章 |

### 6.2 教學導向成就

- 每個成就綁定一個可解釋的語言學概念：
  - 詞性辨識
  - 主題詞彙群
  - 語序
  - 詞綴
- 成就描述中顯示「你實際學到什麼」。

---

## 七、局外節點（Curriculum Tree）

使用 `CP` 解鎖，節點僅提供策略分歧，不做硬性強度通膨。

三條主線：
1. `Fluency`：答題時間容錯、連對收益
2. `Lexicon`：新詞滴入品質、退化詞權重控制
3. `Build`：商店資訊透明度、牌型升級效率

每條 8-10 節點，互斥分支比例約 30%。

---

## 八、資料結構草案

```json
{
  "metaProgress": {
    "playerLevel": 12,
    "xp": 4820,
    "lp": 210,
    "cp": 9,
    "highestStake": 2,
    "unlockedTiers": ["T1", "T2"],
    "discoveredBuildIds": ["sense_001", "material_012"],
    "deckProfiles": [
      {
        "id": "deck_balanced",
        "name": "Balanced",
        "elementWeights": {"Life": 1, "Force": 1, "Mind": 1, "Matter": 1, "Abstract": 1},
        "posWeights": {"N": 1, "V": 1, "A": 1, "D": 1},
        "targetHands": ["GrammarChain", "ElemFlush"]
      }
    ],
    "achievementIds": ["ach_master_100", "ach_stake_s1"],
    "curriculumNodes": ["fluency_01", "lexicon_02"]
  }
}
```

---

## 九、與局內系統接點

1. Run 開始：載入 `deckProfile` 權重，生成本局牌組。
2. Run 結算：回寫 `XP/LP/CP`、單字學習等級、遺忘計時。
3. 商店刷新：讀取已解鎖與已發現卡池權重。
4. Boss 通關：推進 Stake 與課程節點可用性。

---

## 十、落地順序（對應實作）

1. 建立 `MetaProgressData`、`DeckProfileData`、`AchievementData` 結構。
2. 實作 `MetaManager`（讀寫、解鎖、貨幣與獎勵結算）。
3. 接入 Run 結算管線（先做 `XP/LP/CP` 回寫）。
4. 接入詞庫分層解鎖與池權重。
5. 接入 Stake 與 Curriculum Tree。

---

*文件日期：2026-02-12*
*用途：v2 待辦順序 #1 交付物*
