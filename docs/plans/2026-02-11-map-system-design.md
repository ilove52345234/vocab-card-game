# 地圖系統設計

*建立日期：2026-02-11*
*參考來源：殺戮尖塔地圖分析*

---

## 一、設計目標

1. **控制難度曲線**：透過房間分佈與路線規則，確保節奏平滑
2. **提供策略選擇**：路線分支讓玩家在風險與回報間抉擇
3. **融入學習節奏**：休息站整合學習新單字，地圖即學習進度

---

## 二、七種房間類型

| 房間 | 圖示 | 功能 | 獎勵 |
|------|------|------|------|
| **敵人** | ⚔️ | 普通戰鬥 | 卡牌選擇（3選1）+ 40%機率藥水 |
| **精英** | 💀 | 強敵戰鬥（測試特定維度） | 遺物 + 高稀有度卡牌 |
| **休息站** | 🏕️ | 三選一：回血30% / 升級卡牌 / 學習新單字 | 依選擇 |
| **書房** | 📚 | 花學習點數：預習/暫放/進化/深化/筆記 | 構築最佳化 |
| **寶箱** | 🎁 | 獲得遺物或藥水 | 遺物/藥水 |
| **未知** | ❓ | 隨機事件 | 不定 |
| **Boss** | 👑 | 章節最終 Boss | 大量獎勵 + 進入下一章 |

### 休息站：學習新單字選項

- 從未學單字池中隨機 3 個，選 1 個學習
- 立即進行該單字的首次答題（識讀簡單）
- 答對：解鎖對應卡牌加入牌組，該單字進入 Lv.1
- 答錯：仍解鎖但卡牌效果暫時 -20%，直到下次答對

### 設計理念：書房取代商店

本遊戲以「學習」為核心成長來源（60%），因此以「書房」取代傳統商店：
- **書房系統**（詳見 `docs/plans/2026-02-11-study-room-design.md`）：花學習點數進行構築最佳化
- **暫放代替移除**：卡牌暫時移出本次 run 牌組，學習紀錄保留
- 貨幣為「學習點數（LP）」，來自戰鬥中答對的表現

---

## 三、路線生成規則

### 15 步結構

```
步驟  1  2  3  4  5  6  7  8  9  10  11  12  13  14  15  Boss
      ╲╱    ╲╱         收束→寶箱         ╲╱          ╲╱    收束→休息
      發散   發散                         發散         發散
```

### 硬性規則（不可違反）

| # | 規則 | 理由 |
|---|------|------|
| 1 | Boss 前一步（第15步）必為休息站 | 讓玩家有機會回血備戰 |
| 2 | 第 1 步只出敵人房 | 確保立刻進入遊戲 |
| 3 | 前 4 步不出精英 | 牌組還在探索期 |
| 4 | 第 9 步固定寶箱 | 收束點，分割上下半場 |
| 5 | 精英之間至少間隔 3 步 | 避免連續高壓 |
| 6 | 休息站之間至少間隔 4 步 | 避免連續回血太安全 |
| 7 | 不連續出現相同非戰鬥房間 | 維持節奏感 |
| 8 | 書房不出現在前 3 步 | 太早沒有足夠學習點數 |
| 9 | 書房不與休息站相鄰 | 避免連續非戰鬥節奏過緩 |

### 房間分佈比例（每 15 步）

| 房間類型 | 數量 | 比例 |
|---------|------|------|
| 敵人 | 5-6 | ~37% |
| 精英 | 2 | ~13% |
| 休息站 | 2（含 Boss 前） | ~13% |
| 書房 | 1-2 | ~10% |
| 寶箱 | 1（第 9 步固定） | ~7% |
| 未知 | 3-4 | ~20% |

### 未知房間機率池

| 結果 | 初始機率 | 未觸發時累加 |
|------|---------|-------------|
| 特殊事件 | 55% | — |
| 敵人戰鬥 | 10% | 每次+10% |
| 寶箱 | 5% | 每次+5% |

觸發後機率重置為初始值。Boss 擊敗後也重置。

### 路線分支規則

- 每個節點最多 3 條出路、3 條入路
- 1 條出路最常見，3 條最少見
- 每章節約產生 100-200 種可能路線

### 上下半場節奏差異

- **下半場（步驟 1-9）**：戰鬥比例較高，快速構築牌組
- **上半場（步驟 10-15）**：戰鬥比例稍降，帶著成型牌組面對精英和 Boss

---

## 四、三章節遞進設計

| | 第一章：啟程 | 第二章：試煉 | 第三章：深淵 |
|--|------------|------------|------------|
| **主題** | 學習基礎 | 策略深化 | 極限考驗 |
| **敵人HP** | 基準 | ×1.3 | ×1.6 |
| **精英強度** | 測試單維度 | 測試雙維度 | 測試全維度 |
| **休息站學新字** | 3選1（簡單詞） | 3選1（中等詞） | 2選1（困難詞） |
| **戰鬥獎勵卡** | 多 Common | Common+Uncommon | Uncommon+Rare |
| **未知事件** | 偏正面 | 正負均衡 | 偏負面但高回報 |
| **Boss** | 單機制Boss | 雙機制Boss | 三機制Boss |

### Boss 設計哲學

- **第一章 Boss**：單一機制，考驗牌組基礎強度
  - 範例：「只會重擊+格擋」
- **第二章 Boss**：雙機制疊加，需要應對多種威脅
  - 範例：「召喚小怪+自身強化」
- **第三章 Boss**：三機制交替，需要完整的攻/防/成長
  - 範例：「毒+高傷+回血」

### 章節過渡獎勵

打敗 Boss 後，進入下一章前獲得：
1. 一次免費學習新單字的機會（不佔休息站）
2. 從 3 個遺物中選 1 個

---

## 五、收束與發散

**收束點**（所有路線匯聚）：
- 第 9 步（寶箱）：分割上下半場
- 第 15 步（休息站）：Boss 前最後準備

**發散點**（路線分叉最多）：
- 第 2-3 步：初期路線選擇
- 第 10-11 步：下半場開始的策略分歧

**設計意圖**：
- 收束點控制節奏，確保所有玩家在關鍵時刻有相似體驗
- 發散點提供選擇自由，增加重複遊玩性
- 每章 15 步但約 100-200 種路線組合

---

*本文件為地圖生成系統的設計依據，路線生成演算法須遵循所有硬性規則。*
